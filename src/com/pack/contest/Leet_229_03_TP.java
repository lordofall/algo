package com.pack.contest;

import java.util.HashMap;
import java.util.Map;

/**
 * 5687. Maximum Score from Performing Multiplication Operations
 * 
 * @author LordOfAll
 *
 */
public class Leet_229_03_TP {

	public static void main(String[] args) {
		Leet_229_03_TP obj = new Leet_229_03_TP();
//		int[] nums = {1,2,3};
//		int[] multipliers = {3,2,1}; // 14
//		int[] nums = {-5,-3,-3,-2,7,1};
//		int[] multipliers = {-10,-5,3,4,6}; // 14
//		int[] nums = {-947,897,328,-467,14,-918,-858,-701,-518,-997,22,259,-4,968,947,582,-449,895,-121,-403,633,490,64,543,-396,-997,841,-398,247,297,-147,-708,804,-199,-765,-547,-599,406,-223,-11,663,746,-365,-859,256,-25,919,-334,490,-511,865,-139,-968,961,-793,451,317,645,-294,240,-312,-822,961,-572,309,579,161,780,525,-622,-511,423,946,-28,-199,822,-123,-316,-913,113,-458,-428,-414,49,922,722,-854,323,-219,581,302,124,164,31,727,186,308,-936,-937,-862,939,213,966,-74,-76,-1,521,777,-966,454,-199,526,-895,447,-749,-518,-639,849,-771,979,-760,-763,-601,-201,40,-911,207,890,-942,-352,700,267,830,-396,536,877,-896,-687,262,-60,-373,-373,526};
//		int[] multipliers = {864,849,586,769,309,-413,318,652,883,-690,796,251,-648,433,1000,-969,422,194,-785,-242,-118,69,187,-925,-418,-556,88,-399,-619,-383,-188,206,-793,-9,738,-587,878,360,640,318,-399,-366,365,-291,-75,-451,-674,-199,177,862,1,11,390,-52,-101,127,-354,-717,-717,180,655,817,-898,28,-641,-35,-563,-737,283,-223,-322,-59,955,172,230,512,-205,-180,899,169,-663,-253,270,651,168,417,613,-443,980,-189,417,372,-891,-272,993,-877,906,680,-630,-328,-873,-811,78,-667,-2,190,-773,878,529,620,-951,-687,314,-989,-48,-601,-950,31,-789,-663,-480,750,-872,-358,529,-426,-111,517,750,-536,-673,370}; //32383191 
		
		int[] nums = {420,-962,-233,-540,780,-852,-456,-375,-564,-79,-273,-174,461,-691,722,-587,-77,711,-497,-977,812,461,219,-837,654,-95,-466,277,-793,300,-399,-831,102,-169,905,195,-32,-660,791,-696,234,621,682,-34,125,-37,-59,87,-740,-539,378,-455,-131,162,-335,725,839,-601,622,882,777,-35,-891,-495,432,-79,-435,325,-108,-628,356,313,159,-731,-663,-471,237,-689,534,199,196,-957,783,-168,-825,103,-1000,-60,-929,-898,60,733,701,948,350,-541,13,-572,-19,389,545,994,-873,-316,-641,-990,497,330,558,-391,394,784,-540,279,-425,-591,-845,-70,-149,603,-434,726,879,818,-182,-614,-500,409,-279,-567,-464,-786,-501,-830,-826,-336,232,669,461,-66,298,-648,-446,833,-570,-499,446,-579,-319,55,-175,794,803,-569,-167,495,-863,448,286,351,-623,-581,110,757,-856,-33,835,-103,654,-474,-568,290,-786,504,-680,849,306,-126,260,-7,280,-921,-679,668,287,700,-787,-687,554,-640,880,-855,-233,-896,-573,-627,-551,306,-559,353,-743,-291,-763,-462,-917,269,870,913,396,-598,451,-936,151,768,41,643,550,-785,904,-177,-182,-520,-806,-107,-416,71,989,-660,-237,-687,-395,61,937,284,768,432,-454,533,-919,125,182,-411,-352,808,280,102,959,-515,-837,-941,835,-845,-14,-690,474,-174,-546,97,290,-929,-263,288,533,187,309,-759,-942,934,-679,931,-762,-28,-911,749,-622,-874,717,138,549,-864,297,984,982,991,530,-516,-158,-698,-13,-165,-510,-983,46,220,156,500,-193,-268,472,-955,-544,160,-486,-933,600,646,-363,407,-626,353,879,-376,-210,829,11,350,-435,-903,626,558,-970,119,-626,-804,-537,950,852,-470,-787,-838,976,827,-117,-116,-563,-914,366,140,-337,148,626,403,152,295,551,854,500,625,-919,813,-644,31,310,-182,-389,578,-713,84,231,-641,944,-636,-418,873,-413,461,461,529,-25,-84,-47,-64,523,550,222,-348,-669,-522,-297,-572,575,358,701,406,548,-181,308,-896,-289,479,428,-835,623,-766,16,741,420,-485,-963,-19,363,-96,-290,-424,627,-505,718,57,-984,218,-870,187,-669,-562,392,96,548,-469,436,466,-840,117,31,988,-264,-990,-235,-260,678,-720,-534,152,-775,-392,-682,-530,345,634,-780,139,-156,-235,-177,637,-165,-938,-93,277,-421,-786,683,-243,-494,-622,929,-155,357,381,422,-107,-447,458,-36,-500,162,-691,-17,882,-719,-538,496,962,-181,-368,-219,64,965,-694,473,-526,-354,-161,-157,551,66,905,-847,837,622,-583,-947,558,-647,-773,458,717,231,166,198,-969,793,990,277,-549,-939,484,944,-873,380,-508,-792,897,-477,-811,591,-22,41,-997,979,-856,-591,554,405,-878,-592,112,483,842,345,465,-882,849,-102,-371,-430,-157,-467,-33,-558,46};
		int[] multipliers = {195,315,574,-203,18,-99,936,-679,-404,66,-271,-432,-636,50,-475,131,836,983,148,22,176,-810,-81,822,-101,887,42,-517,338,-205,-640,137,-375,791,-71,-887,194,-199,573,-330,-867,567,-429,753,972,614,-713,826,-366,-281,-361,39,-239,-97,532,-444,801,-414,-463,224,-749,-523,109,842,-867,-345,-207,-123,-610,344,556,815,-515,249,-59,532,-217,-54,-967,964,47,291,47,-105,-769,313,977,-183,75,-224,704,-41,508,-953,513,-201,-199,-422,-7,-489,-64,233,-279,131,-634,937,-33,-525,12,27,-525,-768,963,-24,714,643,-301,-253,514,866,-567,317,-166,-469,-475,-942,-452,-150,279,-124,-464,208,-785,752,-974,998,242,209,947,-428,674,478,435,432,99,-720,-317,-461,-372,267,-207,-870,224,-819,743,998,-586,102,374,360,581,-112,-878,-662,-273,-231,-940,-418,-600,933,-963,320,-457,836,-550,-958,-369,-215,886,-835,541,73,-979,-792,-26,823,332,-558,475,453,200,-418,399,-635,-232,263,-271,-581,423,-329,-107,-371,-528,-544,-504,855,768,-539,-564,-702,-698,-495,-454,666,-619,811,-815,-373,607,-518,612,-584,-888,-951,-2,-321,720,931,-153,-798,-362,429,518,-202,-784,414,-795,430,-592,427,506,629,338,975,97,30,439,-493,-656,563,663,308,-231,315,18,222,345,-975,712,495,313,311,258,-23,403,-92,-498,577,525,800,-710,-127,-181,385,826,-394,999,714,475,475,-806,418,-695,-280,120,-168,-159,-295,-533,508,-285,-237,271,660,409,-23,207,833,573,406,-906,594,-122,916,-606,519,395,495,301,-438,949,-872,-646,543,959,207,-110,-932,-443,495,-957,-380,-737,-475,-474,-779,11,686,347,713,-102,-498,46,639,-840,-112,-278,545,501,-998,-186,615,-367,118,-247,-415,-476,783,608,128,661,-969,610,634,-513,-61,299,311,-493,-841,75,830,-202,-133,-550,-869,866,-776,684,342,182,82,-523,203,-788,-861,166,-368,-435,787,313,-278,656,917,-530,686,-650,910,817,-616,676,369,-606,-480,-957,-44,253,-762,-26,-326,-10,41,-533,-173,-729,-591,-875,842,185,434,621,271,-704,-147,-223,-182,-494,-238,158,767,25,-216,894,975,652,231,-527,-119,230,-774,301,-451,705,-861,65,-702,996,-483,-174,699,-666,-747,-585,518,-960,984,-29,-623,199,-601,455,579,-188,-303,-162,-221,-459,-863,770,887,-229,352,410,537,644,-681,-568,956,461,-853,148,236,-169,-31,-932,452,-648,461,776,342,-578,-688,991,-919,-5};

		System.out.println(obj.maximumScore(nums, multipliers));

	}

	public int maximumScore(int[] nums, int[] multipliers) {
		Map<String, String> map = new HashMap<>();
        return maximumScore(nums, multipliers, 0, nums.length-1,0,0, map);
    }
	
	public int maximumScore(int[] nums, int[] multipliers, int lIndex, int rIndex, int mIndex, int scoreSoFar, 
			Map<String, String> map) {
		String key = ""+lIndex+"_"+rIndex+"";
		String side = map.get(key);
		
		if(mIndex == multipliers.length) {
			return scoreSoFar;
		}
		// if we take left
		if (side != null) {
			if (side.equals("left")) {
				return maximumScore(nums, multipliers, lIndex + 1, rIndex, mIndex + 1,
						nums[lIndex] * multipliers[mIndex] + scoreSoFar, map);
			} else {
				 return maximumScore(nums, multipliers,lIndex, rIndex -1, mIndex +1,
							nums[rIndex]*multipliers[mIndex] + scoreSoFar, map);
			}
		}
		int result1 = maximumScore(nums, multipliers,lIndex+1, rIndex, mIndex+1, 
				nums[lIndex]*multipliers[mIndex] + scoreSoFar, map);
		
		// if we take right
		int result2 =  maximumScore(nums, multipliers,lIndex, rIndex -1, mIndex +1,
				nums[rIndex]*multipliers[mIndex] + scoreSoFar, map);
		
		if(result1 > result2)
			map.put(key, "left");
		else
			map.put(key, "right");
				
		return Math.max(result1, result2);		
	}
	
	
	
	
}
